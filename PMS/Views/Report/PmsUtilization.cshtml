@{
    Layout = null;
}


<script src="~/assets/js/table2excel.js"></script>
<section class="content">
    <div class="panel panel-solid">
        <div class="panel-body" ng-init="onInit();">
            <div class="row margin">
                <div class="panel">
                    <h3 style="padding: 0 15px;"></h3>
                    <div class="panel-body">


                        <div>
                            <h2>PMS Utilization</h2>

                            <!--Personal Info-->
                            <table class="table table-condensed table-hover" id="PmsUtilization">
                                <tr>

                                    <th>Employee ID</th>
                                    <th>Employee Name</th>
                                    <th>Department</th>
                                    <th>Covered</th>
                                    <th>KRA Rating</th>
                                    <th>Behavioral Rating</th>
                                    <th>Final Rating</th>
                                </tr>
                                <tr ng-repeat="personalinfoList in personalInfo">

                                    @*<td><a class="pointer" ng-show="onCheckOpenPaf(xx.pmsPafMaster)" ng-click="onViewPaf(xx,x.pmsLstType)">Open</a></td>*@
                                    <td>{{personalinfoList.employeeId}}</td>
                                    <td>{{personalinfoList.EmployeeName}}</td>
                                    <td>{{personalinfoList.BranchName}}</td>
                                    <td>{{personalinfoList.PeriodFrom}} - {{personalinfoList.PeriodTo}}</td>
                                    @*<td>
                        <div ng-init="krapercent = personalinfoList.BusinesssProcess + personalinfoList.PeopleDevelopment + personalinfoList.Customer + personalinfoList.Financial">
                                <div ng-init="krarating = 1" ng-if="krapercent<70" ng-show="krapercent<70">
                                          {{krarating}}
                                 </div>
                                <div ng-init="krarating = 2" ng-if="krapercent>=70 && krapercent <80" ng-show="krapercent>=70 && krapercent <80">
                                          {{krarating}}
                                 </div>
                                <div ng-init="krarating = 3" ng-if="krapercent >=80 && krapercent <90" ng-show="krapercent >=80 && krapercent <90">
                                          {{krarating}}
                                  </div>
                                <div ng-init="krarating = 4" ng-if="krapercent >=90 && krapercent <100" ng-show="krapercent >=90 && krapercent <100">
                                {{krarating}}
                                 </div>
                                 <div ng-init="krarating = 5" ng-if=" krapercent >=100" ng-show=" krapercent >=100">
                                  {{krarating}}
                                 </div>

                        </div>
                    </td>*@
                                    <td>
                                        <div ng-init="krapercent = personalinfoList.BusinesssProcess + personalinfoList.PeopleDevelopment + personalinfoList.Customer + personalinfoList.Financial">
                                            <div ng-init="krarating = 1" ng-if="krapercent<70" ng-show="krapercent<70">
                                                <div ng-init="kraweight=(krarating * personalinfoList.KRWeight)/100">
                                                    {{kraweight}}
                                                </div>
                                            </div>
                                            <div ng-init="krarating = 2" ng-if="krapercent>=70 && krapercent <80" ng-show="krapercent>=70 && krapercent <80">
                                                <div ng-init="kraweight=(krarating * personalinfoList.KRWeight)/100">
                                                    {{kraweight}}
                                                </div>
                                            </div>
                                            <div ng-init="krarating = 3" ng-if="krapercent >=80 && krapercent <90" ng-show="krapercent >=80 && krapercent <90">
                                                <div ng-init="kraweight=(krarating * personalinfoList.KRWeight)/100">
                                                    {{kraweight}}
                                                </div>
                                            </div>
                                            <div ng-init="krarating = 4" ng-if="krapercent >=90 && krapercent <100" ng-show="krapercent >=90 && krapercent <100">
                                                <div ng-init="kraweight=(krarating * personalinfoList.KRWeight)/100">
                                                    {{kraweight}}
                                                </div>
                                            </div>
                                            <div ng-init="krarating = 5" ng-if=" krapercent >=100" ng-show=" krapercent >=100">
                                                <div ng-init="kraweight=(krarating * personalinfoList.KRWeight)/100">
                                                    {{kraweight}}
                                                </div>
                                            </div>

                                        </div>

                                    </td>
                                    @*<td>


                        {{personalinfoList.Behavioral}}


                    </td>*@
                                    <td>
                                        <div ng-init="behavioralrating = (personalinfoList.Behavioral * personalinfoList.BIWeight)/100">
                                            {{behavioralrating}}
                                        </div>
                                    </td>
                                    <td>


                                        <div ng-init="krapercent = personalinfoList.BusinesssProcess + personalinfoList.PeopleDevelopment + personalinfoList.Customer + personalinfoList.Financial">
                                            <div ng-init="krarating = 1" ng-if="krapercent<70" ng-show="krapercent<70">
                                                <div ng-init="kraweight=(krarating * personalinfoList.KRWeight)/100">

                                                    <div ng-init="behavioralrating = (personalinfoList.Behavioral * personalinfoList.BIWeight)/100">
                                                        {{kraweight + behavioralrating  | number : 2}}
                                                    </div>
                                                </div>
                                            </div>
                                            <div ng-init="krarating = 2" ng-if="krapercent>=70 && krapercent <80" ng-show="krapercent>=70 && krapercent <80">
                                                <div ng-init="kraweight=(krarating * personalinfoList.KRWeight)/100">

                                                    <div ng-init="behavioralrating = (personalinfoList.Behavioral * personalinfoList.BIWeight)/100">
                                                        {{kraweight + behavioralrating  | number : 2}}
                                                    </div>
                                                </div>
                                            </div>
                                            <div ng-init="krarating = 3" ng-if="krapercent >=80 && krapercent <90" ng-show="krapercent >=80 && krapercent <90">
                                                <div ng-init="kraweight=(krarating * personalinfoList.KRWeight)/100">

                                                    <div ng-init="behavioralrating = (personalinfoList.Behavioral * personalinfoList.BIWeight)/100">
                                                        {{kraweight + behavioralrating  | number : 2}}
                                                    </div>
                                                </div>
                                            </div>
                                            <div ng-init="krarating = 4" ng-if="krapercent >=90 && krapercent <100" ng-show="krapercent >=90 && krapercent <100">
                                                <div ng-init="kraweight=(krarating * personalinfoList.KRWeight)/100">

                                                    <div ng-init="behavioralrating = (personalinfoList.Behavioral * personalinfoList.BIWeight)/100">
                                                        {{kraweight + behavioralrating  | number : 2}}
                                                    </div>
                                                </div>
                                            </div>
                                            <div ng-init="krarating = 5" ng-if=" krapercent >=100" ng-show=" krapercent >=100">
                                                <div ng-init="kraweight=(krarating * personalinfoList.KRWeight)/100">

                                                    <div ng-init="behavioralrating = (personalinfoList.Behavioral * personalinfoList.BIWeight)/100">
                                                        {{kraweight + behavioralrating  | number : 2}}
                                                    </div>
                                                </div>
                                            </div>

                                        </div>





                                    </td>

                                </tr>

                            </table>
                        </div>












                        <button class="btn btn-success btn-rounded btn-gradient" ng-click="Export();">Export</button>
                        <div style="position: absolute; opacity: 0; pointer-events:none;">
                            <div>
                                <canvas id="uploadedimage"></canvas>
                                <br />
                            </div>
                        </div>

                        @*<div style="margin-bottom:5px;">
            <a class="btn btn-primary btn-sm btn-gradient btn-rounded pointer" ng-click="openModalForm('#modal-sourcetype-signature');CaptureSignature();">Add Signature</a>

        </div>*@

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<!-- View Personal CDP-->
<div id="modal-panel-viewpersonalcdp" class="popup-basic popup-lg bg-none mfp-with-anim mfp-hide">

    <div class="panel">
        <div class="panel-heading">
            <span class="panel-icon"><span class="glyphicon glyphicon-print"></span></span>
            <span class="panel-title">{{ctrl.title}}</span>
            <div class="panel-header-menu pull-right mr30">
                <a ng-click="Export();" class="btn btn-xs btn-default btn-gradient mr5 pointer"> <i class="glyphicons glyphicons-print"></i>  </a>
            </div>
        </div>


        <form class="form-horizontal" name="UpdateActionPlanForm" autocomplete="off">
            <div class="panel-body" id="cdpreport">


                <!--Personal Info-->
                <table class="table table-bordered" style="table-layout:fixed">
                    <thead>
                        <tr>
                            <th colspan="1" style="border-right-color:white;">
                                <div>

                                    <img src="~/assets/img/fastlogo.png" style="height:50px;width:150px" />

                                </div>

                            </th>
                            <th colspan="3" style="border-left-color:white;">
                                <div>
                                    <h2>
                                        Career Development Plan
                                    </h2>
                                </div>
                            </th>

                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="width:1px">Employee Name:</td>
                            <td>{{employeename}}</td>
                            <td style="white-space:nowrap;">Immediate Head Name:</td>
                            <td>{{immediatename}}</td>
                        </tr>
                        <tr>
                            <td>Position</td>
                            <td>{{employeeposition}}</td>
                            <td>Position</td>
                            <td>{{immediateposition}}</td>
                        </tr>


                    </tbody>
                    <tbody ng-repeat="categories in category | groupBy:'categoryname'">
                        <tr>
                            <td colspan="4">
                                <div ng-repeat="categoryList in categories | unique:'categoryname'">
                                    {{$index + 1}}.
                                    &nbsp; {{categoryList.categoryname}}
                                </div>



                            </td>

                        </tr>
                        <tr ng-repeat-start="goalplanList in categories track by $index">
                            <td>
                                Goal Plan
                            </td>
                            <td style="padding-bottom: 0px;padding-right: 0px;padding-top: 0px;padding-left: 0px;border-bottom-width: 0px;border-right-width: 0px;border-top-width: 0px;border-left-width: 0px;" colspan="3">
                                <table class="table table-bordered" style="table-layout:fixed">
                                    <tr>
                                        <td>
                                            {{$index + 1}}.
                                            &nbsp; {{goalplanList.goaldescription}}
                                        </td>
                                        <td>{{goalplanList.iscompleted === O ? 'Open':'Close'}}</td>
                                        <td>{{goalplanList.achievedate === null ? 'Not yet Completed':goalplanList.achievedate| date:'mediumDate'}}</td>

                                    </tr>
                                </table>










                            </td>
                        </tr>

                        <tr ng-repeat-end ng-if="goalplanList.actionplan.length > 0">
                            <td rowspan="{{goalplanList.actionplan.length}}">
                                Action Plan
                            </td>
                            <td style="padding-bottom: 0px;padding-right: 0px;padding-top: 0px;padding-left: 0px;border-bottom-width: 0px;border-right-width: 0px;border-top-width: 0px;border-left-width: 0px;" colspan="3">
                                <table class="table table-bordered" style="table-layout:fixed">
                                    <tr ng-repeat="actionplanList in goalplanList.actionplan">
                                        <td>
                                            {{actionplanList.actiondescription}}
                                        </td>
                                        <td>{{actionplanList.iscompleted === 0 ? 'Open':'Close'}}</td>
                                        <td>{{actionplanList.completedate === null ? 'Not yet Completed':actionplanList.completedate| date:'mediumDate'}}</td>

                                    </tr>
                                </table>










                            </td>

                        </tr>


                    </tbody>










                </table>






                <div>
                    <div style="position:relative;width:150px;float:left">

                        <div style="position:absolute;">
                            <img ng-src="data:image/jpg;base64,{{employeesignature}}" />
                        </div>
                        <div style="padding-top:100px">

                            {{employeename}}

                        </div>




                    </div>
                    <div style="position:relative;background:white;width:150px;float:right">

                        <div style="position:absolute;">
                            <img ng-src="data:image/jpg;base64,{{immediatesignature}}" />
                        </div>
                        <div style="padding-top:100px">

                            {{immediatename}}

                        </div>




                    </div>
                </div>



                <div>
                    <div style="position: absolute; pointer-events:none;">
                        <div>
                            <canvas id="signature-pad2"></canvas>
                            <br />
                        </div>
                    </div>
                    <div style="position: absolute; pointer-events:none;">
                        <div>
                            <canvas id="signature-pad-empty"></canvas>
                            <br />
                        </div>
                    </div>
                </div>




                <div>
                    <a class="btn btn-info btn-sm btn-gradient btn-rounded pointer" ng-click="Export();">Export</a>

                </div>


            </div>
        </form>

    </div>
</div>



<!-- View Subordinate CDP-->
<div id="modal-panel-viewsubordinatecdp" class="popup-basic popup-lg bg-none mfp-with-anim mfp-hide">

    <div class="panel">
        <div class="panel-heading">
            <span class="panel-icon"><span class="glyphicon glyphicon-print"></span></span>
            <span class="panel-title">{{ctrl.title}}</span>
            <div class="panel-header-menu pull-right mr30">
                <a ng-click="Export();" class="btn btn-xs btn-default btn-gradient mr5 pointer"> <i class="glyphicons glyphicons-print"></i>  </a>
            </div>
        </div>
        <form class="form-horizontal" name="UpdateActionPlanForm" autocomplete="off">
            <div class="panel-body" id="cdpreport">


                <!--Personal Info-->
                <table class="table table-bordered" style="table-layout:fixed">
                    <thead>
                        <tr>
                            <th colspan="1" style="border-right-color:white;">
                                <div>

                                    <img src="~/assets/img/fastlogo.png" style="height:50px;width:150px" />

                                </div>

                            </th>
                            <th colspan="3" style="border-left-color:white;">
                                <div>
                                    <h2>
                                        Career Development Plan
                                    </h2>
                                </div>
                            </th>

                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Employee Name:</td>
                            <td>{{employeename}}</td>
                            <td>Immediate Head Name:</td>
                            <td>{{immediatename}}</td>
                        </tr>
                        <tr>
                            <td>Position</td>
                            <td>{{employeeposition}}</td>
                            <td>Position</td>
                            <td>{{immediateposition}}</td>
                        </tr>


                    </tbody>
                    <tbody ng-repeat="categories in category | groupBy:'categoryname'">
                        <tr>
                            <td>
                                <div ng-repeat="categoryList in categories | unique:'categoryname'">
                                    {{$index + 1}}.
                                    &nbsp; {{categoryList.categoryname}}
                                </div>



                            </td>
                            <td style="width:1px;text-align:right;">
                                Status
                            </td>
                            <td style="width:1px;text-align:right;">
                                Completion Date
                            </td>

                        </tr>
                        <tr ng-repeat-start="goalplanList in categories track by $index">
                            <td>
                                Goal Plan
                            </td>
                            <td style="padding-bottom: 0px;padding-right: 0px;padding-top: 0px;padding-left: 0px;border-bottom-width: 0px;border-right-width: 0px;border-top-width: 0px;border-left-width: 0px;" colspan="3">
                                <table class="table table-bordered" style="table-layout:fixed">
                                    <tr>
                                        <td>
                                            {{$index + 1}}.
                                            &nbsp; {{goalplanList.goaldescription}}
                                        </td>
                                        <td>
                                            Goal Achived?
                                            <input type="checkbox" ng-model="pendingordertransactionList.checked" ng-change="toggleHistory()" />Yes
                                            <input type="checkbox" ng-model="pendingordertransactionList.checked" ng-change="toggleHistory()" />No

                                        </td>
                                    </tr>
                                </table>










                            </td>
                        </tr>

                        <tr ng-repeat-end ng-repeat="actionplanList in goalplanList.actionplan">
                            <td>
                                Action Plan
                            </td>
                            <td style="padding-bottom: 0px;padding-right: 0px;padding-top: 0px;padding-left: 0px;border-bottom-width: 0px;border-right-width: 0px;border-top-width: 0px;border-left-width: 0px;" colspan="3">
                                <table class="table table-bordered" style="table-layout:fixed">
                                    <tr>
                                        <td>
                                            {{actionplanList.actiondescription}}
                                        </td>
                                        <td>
                                            Action Completed?
                                            <input type="checkbox" ng-model="pendingordertransactionList.checked" ng-change="toggleHistory()" />Yes
                                            <input type="checkbox" ng-model="pendingordertransactionList.checked" ng-change="toggleHistory()" />No

                                        </td>
                                    </tr>
                                </table>










                            </td>

                        </tr>


                    </tbody>










                </table>





                <div>
                    <div style="position:relative;width:150px;float:left">

                        <div style="position:absolute;">
                            <img ng-src="data:image/jpeg;base64,{{subordinatesignature}}" />
                        </div>
                        <div style="padding-top:100px">

                            {{employeename}}

                        </div>




                    </div>
                    <div style="position:relative;width:150px;float:right">

                        <div style="position:absolute;">
                            <img ng-src="data:image/jpeg;base64,{{employeesignature}}" />
                        </div>
                        <div style="padding-top:100px">

                            {{immediatename}}

                        </div>




                    </div>
                </div>




                <div>
                    <div style="position: absolute; pointer-events:none;">
                        <div>
                            <canvas id="signature-pad2"></canvas>
                            <br />
                        </div>
                    </div>
                    <div style="position: absolute; pointer-events:none;">
                        <div>
                            <canvas id="signature-pad-empty"></canvas>
                            <br />
                        </div>
                    </div>
                </div>







            </div>
        </form>

    </div>
</div>


<!--Signature-->
<div id="modal-sourcetype-signature" class="popup-basic popup-sm bg-none mfp-with-anim mfp-hide">
    <div class="panel">
        <div class="panel-heading">
            <span class="panel-title"><i class="glyphicon glyphicon-pencil"></i>&nbsp; Signature</span>
        </div>
        <div class="panel-body">
            <div style="position:relative;width:260px;height:120px;">

                <div style="position:absolute;opacity:0.2;width:250px;">
                    <canvas id="signature-pad"></canvas>
                </div>
                <div style="padding-top:100px;text-align:center;">
                    <hr style="margin-bottom: 0px;margin-top: 0px;" />
                    <p>{{employeename}}</p>

                </div>


                <div class="row">
                    <div class="col-md-12">
                        <textarea id="sig-dataUrl" class="form-control" rows="5">Data URL for your signature will go here!</textarea>
                    </div>
                </div>
                <br />
                <div class="row">
                    <div class="col-md-12">
                        <img id="sig-image" src="" alt="Your signature will go here!" />
                    </div>
                </div>

            </div>

            <div>
                <div style="position: absolute;background:white; opacity:0;pointer-events:none;">
                    <div>
                        <canvas id="signature-pad2"></canvas>
                        <br />
                    </div>
                </div>
                <div style="position: absolute; pointer-events:none;">
                    <div>
                        <canvas id="signature-pad-empty"></canvas>
                        <br />
                    </div>
                </div>
            </div>
        </div>
        <div class="panel-footer text-right">
            <button class="btn btn-default btn-rounded btn-gradient" ng-click="closeModalForm()">Clear</button>
            <button class="btn btn-success btn-rounded btn-gradient" ng-click="SaveSignature();">Save</button>
        </div>
    </div>
</div>


<!-- View  CDP per Year-->
<div id="modal-panel-viewcdp" class="popup-basic popup-lg bg-none mfp-with-anim mfp-hide">
    <div class="panel">
        <div class="panel-heading">
            <span class="panel-title">
                <i class="glyphicon glyphicon-tasks">
                </i>Cdp for the Year
            </span>
        </div>
        <form class="form-horizontal" name="AddCdp" autocomplete="off">
            <div class="panel-body">

                <H1 ng-show="cdlist.length <= 0">NO data!</H1>
                <table class="table table-condensed table-hover" ng-show="cdplist.length > 0">
                    <tr>
                        <th>Action</th>
                        <th>CD Id</th>
                        <th>Year Covered</th>
                        <th>Date Created</th>
                        <th>Status</th>
                    </tr>
                    <tr ng-repeat="cdList in cdplist">
                        <td>

                            <a class="pointer" ng-click="ViewCdpReport(cdList)">preview</a>
                            @*<a class="pointer" ng-click="onEditPano(x.hashcode,x.status, x.pafId)">View</a>*@
                        </td>


                        <td>{{cdList.cdpid}}</td>
                        <td>{{cdList.yearno}}</td>
                        <td>{{cdList.createdate | date:'MM/dd/yyyy'}}</td>
                        <td>{{cdList.status=='O'? 'OPEN':'CLOSE'}}</td>
                    </tr>

                </table>




            </div>
            <div class="panel-footer text-right">
                <button class="btn" ng-click="closeModalForm()">Cancel</button>
            </div>
        </form>
    </div>
</div>